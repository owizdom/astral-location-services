(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{43071:function(e,t,n){Promise.resolve().then(n.bind(n,87956))},87956:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var a,i,r=n(24004),s=n(14978);class c{normalizeInput(e){return"string"==typeof e?{uid:e}:"object"==typeof e&&"type"in e&&"Feature"===e.type&&"geometry"in e?e.geometry:e}async distance(e,t,n){return this.request("/compute/v0/distance",{from:this.normalizeInput(e),to:this.normalizeInput(t),schema:n.schema,recipient:n.recipient})}async area(e,t){return this.request("/compute/v0/area",{geometry:this.normalizeInput(e),schema:t.schema,recipient:t.recipient})}async length(e,t){return this.request("/compute/v0/length",{geometry:this.normalizeInput(e),schema:t.schema,recipient:t.recipient})}async contains(e,t,n){return this.request("/compute/v0/contains",{container:this.normalizeInput(e),containee:this.normalizeInput(t),schema:n.schema,recipient:n.recipient})}async within(e,t,n,a){return this.request("/compute/v0/within",{geometry:this.normalizeInput(e),target:this.normalizeInput(t),radius:n,schema:a.schema,recipient:a.recipient})}async intersects(e,t,n){return this.request("/compute/v0/intersects",{geometry1:this.normalizeInput(e),geometry2:this.normalizeInput(t),schema:n.schema,recipient:n.recipient})}async health(){let e=await fetch("".concat(this.apiUrl,"/health"));if(!e.ok)throw Error("Health check failed: ".concat(e.statusText));return e.json()}async request(e,t){let n=await fetch("".concat(this.apiUrl).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chainId:this.chainId,...t})});if(!n.ok){let e=await n.json().catch(()=>({detail:n.statusText}));throw Error("Astral API error: ".concat(e.detail||n.statusText))}return n.json()}constructor(e){var t,n;this.apiUrl=null!==(n=null===(t=e.apiUrl)||void 0===t?void 0:t.replace(/\/$/,""))&&void 0!==n?n:"https://api.astral.global",this.chainId=e.chainId}}var o=n(30601);let l={84532:"0x4200000000000000000000000000000000000021",8453:"0x4200000000000000000000000000000000000021",1:"0xA1207F3BBa224E2c9c3c6D5aF63D0eb1582Ce587",11155111:"0xC2679fBD37d54388Ce493F1DB75320D236e1815e"};class u{async submitDelegated(e){let{message:t,signature:n,attester:a}=e,i=await this.eas.attestByDelegation({schema:t.schema,data:{recipient:t.recipient,expirationTime:t.expirationTime,revocable:t.revocable,refUID:t.refUID,data:t.data,value:t.value},signature:{v:n.v,r:n.r,s:n.s},attester:a,deadline:t.deadline});return{uid:await i.wait()}}async estimateGas(e){let{message:t,signature:n,attester:a}=e,i=this.eas.contract,r={schema:t.schema,data:{recipient:t.recipient,expirationTime:t.expirationTime,revocable:t.revocable,refUID:t.refUID,data:t.data,value:t.value},signature:{v:n.v,r:n.r,s:n.s},attester:a,deadline:t.deadline};return await i.attestByDelegation.estimateGas(r)}getContractAddress(){return this.eas.contract.target}constructor(e,t,n){let a=n||l[t];if(!a)throw Error("No EAS contract address for chain ".concat(t));this.eas=new o.BL(a),this.eas.connect(e),this.signer=e}}var h=n(69599),d=n(120);let m=Number(null!==(a=d.env.NEXT_PUBLIC_CHAIN_ID)&&void 0!==a?a:84532),p=null!==(i=d.env.NEXT_PUBLIC_RESOLVER_SCHEMA_UID)&&void 0!==i?i:"";function g(){let[e,t]=(0,s.useState)(null),[n,a]=(0,s.useState)(""),[i,o]=(0,s.useState)(""),[l,g]=(0,s.useState)(null);async function v(){var e;let n=window.ethereum;if(!n){o("No wallet found");return}let a=await n.request({method:"eth_requestAccounts"});t(null!==(e=a[0])&&void 0!==e?e:null),o(a[0]?"Connected":"No account")}async function y(){if(!e||!p){o("Connect wallet and set NEXT_PUBLIC_RESOLVER_SCHEMA_UID");return}o("Running within check...");try{var t,a,i;let r=(a={apiUrl:null!==(t=d.env.NEXT_PUBLIC_ASTRAL_API_URL)&&void 0!==t?t:"https://api.astral.global",chainId:m},new c(a)),s=n.trim()||"0x0000000000000000000000000000000000000000000000000000000000000000",l=await r.within({type:"Point",coordinates:[-122.4194,37.7749]},s,5e4,{schema:p,recipient:e});if(o("Within 50km: ".concat(l.result)),l.result&&l.delegatedAttestation){o("Submitting attestation onchain...");let e=new h.Q(window.ethereum),t=(i=await e.getSigner(),new u(i,m,void 0)),n=function(e){var t;let n=e.attestation,a=e.delegatedAttestation,i=n.signature.startsWith("0x")?n.signature.slice(2):n.signature,r="0x"+i.slice(0,64),s="0x"+i.slice(64,128),c=parseInt(i.slice(128,130),16);return{message:{schema:n.schema,recipient:n.recipient,expirationTime:BigInt(0),revocable:!0,refUID:"0x0000000000000000000000000000000000000000000000000000000000000000",data:n.data,value:BigInt(0),nonce:BigInt(null!==(t=a.nonce)&&void 0!==t?t:0),deadline:BigInt(a.deadline)},signature:{v:c,r,s},attester:a.attester}}(l),{uid:a}=await t.submitDelegated(n);g(a),o("Attestation submitted: ".concat(a))}}catch(e){o("Error: ".concat(e instanceof Error?e.message:String(e)))}}return(0,r.jsxs)("main",{style:{padding:24,fontFamily:"system-ui"},children:[(0,r.jsx)("h1",{children:"Astral Location – Frontend Example"}),e?(0,r.jsxs)("p",{children:["Connected: ",e.slice(0,8),"…"]}):(0,r.jsx)("button",{type:"button",onClick:v,children:"Connect wallet"}),(0,r.jsxs)("div",{style:{marginTop:16},children:[(0,r.jsx)("label",{children:"Landmark attestation UID (optional): "}),(0,r.jsx)("input",{value:n,onChange:e=>a(e.target.value),placeholder:"0x...",style:{width:400,marginLeft:8}})]}),(0,r.jsx)("div",{style:{marginTop:16},children:(0,r.jsx)("button",{type:"button",onClick:y,children:"Run within(50km) and submit"})}),i&&(0,r.jsx)("p",{style:{marginTop:16},children:i}),l&&(0,r.jsxs)("p",{style:{marginTop:8,wordBreak:"break-all"},children:["UID: ",l]})]})}}},function(e){e.O(0,[460,297,470,146,744],function(){return e(e.s=43071)}),_N_E=e.O()}]);